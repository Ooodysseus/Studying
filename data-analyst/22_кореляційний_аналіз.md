# Кореляційний аналіз

## Зміст розділу

-   [Вступ до кореляційного аналізу](#вступ-до-кореляційного-аналізу)
-   [Коефіцієнт кореляції Пірсона](#коефіцієнт-кореляції-пірсона)
-   [Коефіцієнт рангової кореляції Спірмена](#коефіцієнт-рангової-кореляції-спірмена)
-   [Коефіцієнт кореляції Кендалла](#коефіцієнт-кореляції-кендалла)
-   [Точково-бісеріальна кореляція](#точково-бісеріальна-кореляція)
-   [Часткова кореляція](#часткова-кореляція)
-   [Кореляційна матриця](#кореляційна-матриця)
-   [Теплова карта кореляцій](#теплова-карта-кореляцій)
-   [Інтерпретація коефіцієнтів кореляції](#інтерпретація-коефіцієнтів-кореляції)
-   [Кореляція vs причинно-наслідковий зв'язок](#кореляція-vs-причинно-наслідковий-зв-язок)
-   [Статистична значущість кореляції](#статистична-значущість-кореляції)
-   [Практичні приклади аналізу](#практичні-приклади-аналізу)
-   [Типові помилки при інтерпретації кореляції](#типові-помилки-при-інтерпретації-кореляції)

## Вступ до кореляційного аналізу

[Буде наповнено: Визначення кореляційного аналізу, його роль у виявленні взаємозв'язків між змінними. Історичний розвиток методу. Основні принципи та застосування в аналізі даних.]

### Важливість кореляційного аналізу в EDA

[Буде наповнено: Як кореляційний аналіз допомагає виявляти залежності в даних та формувати гіпотези для подальшого дослідження.]

### Типи кореляційних зв'язків

[Буде наповнено: Позитивна, негативна та нульова кореляція. Лінійні та нелінійні кореляційні зв'язки. Візуальні приклади різних типів кореляції.]

## Коефіцієнт кореляції Пірсона

[Буде наповнено: Детальний опис коефіцієнта кореляції Пірсона. Формула розрахунку, властивості та інтерпретація.]

### Математичне визначення

[Буде наповнено: Формула коефіцієнта Пірсона з поясненням кожного компонента.]

```python
# Приклад розрахунку коефіцієнта кореляції Пірсона
import numpy as np
import pandas as pd
from scipy import stats

# Генерація прикладу даних
np.random.seed(0)
x = np.random.normal(0, 1, 100)
y = x * 0.8 + np.random.normal(0, 0.5, 100)  # Лінійна залежність з шумом

# Розрахунок кореляції Пірсона
pearson_corr, p_value = stats.pearsonr(x, y)
print(f"Коефіцієнт кореляції Пірсона: {pearson_corr:.4f}")
print(f"P-значення: {p_value:.6f}")
```

### Припущення та обмеження

[Буде наповнено: Вимоги до даних для коректного застосування кореляції Пірсона. Обмеження методу та випадки, коли його застосування недоцільне.]

## Коефіцієнт рангової кореляції Спірмена

[Буде наповнено: Опис рангової кореляції Спірмена, її відмінності від кореляції Пірсона. Випадки, коли перевага надається ранговій кореляції.]

### Розрахунок та інтерпретація

[Буде наповнено: Метод розрахунку коефіцієнта Спірмена, його властивості та тлумачення результатів.]

```python
# Приклад розрахунку коефіцієнта рангової кореляції Спірмена
spearman_corr, p_value = stats.spearmanr(x, y)
print(f"Коефіцієнт рангової кореляції Спірмена: {spearman_corr:.4f}")
print(f"P-значення: {p_value:.6f}")
```

### Порівняння з коефіцієнтом Пірсона

[Буде наповнено: Порівняльний аналіз коефіцієнтів Пірсона та Спірмена. Коли використовувати кожен з них.]

## Коефіцієнт кореляції Кендалла

[Буде наповнено: Опис коефіцієнта кореляції Кендалла (тау Кендалла). Особливості методу та випадки його застосування.]

### Методика розрахунку

[Буде наповнено: Алгоритм розрахунку коефіцієнта Кендалла з поясненням концепції конкордантних та дискордантних пар.]

```python
# Приклад розрахунку коефіцієнта кореляції Кендалла
kendall_corr, p_value = stats.kendalltau(x, y)
print(f"Коефіцієнт кореляції Кендалла: {kendall_corr:.4f}")
print(f"P-значення: {p_value:.6f}")
```

### Особливості застосування

[Буде наповнено: Ситуації, в яких коефіцієнт Кендалла має переваги над іншими методами. Робота з малими вибірками та даними з викидами.]

## Точково-бісеріальна кореляція

[Буде наповнено: Опис точково-бісеріальної кореляції для аналізу зв'язку між неперервною та бінарною змінними.]

### Приклад розрахунку та інтерпретації

[Буде наповнено: Методика розрахунку точково-бісеріальної кореляції та тлумачення результатів.]

```python
# Приклад розрахунку точково-бісеріальної кореляції
binary_var = np.random.choice([0, 1], size=100)
point_biserial_corr, p_value = stats.pointbiserialr(binary_var, y)
print(f"Точково-бісеріальна кореляція: {point_biserial_corr:.4f}")
print(f"P-значення: {p_value:.6f}")
```

## Часткова кореляція

[Буде наповнено: Концепція часткової кореляції для вимірювання зв'язку між змінними з контролем впливу третьої змінної.]

### Розрахунок та використання

[Буде наповнено: Методика розрахунку часткової кореляції та випадки її застосування в багатовимірному аналізі.]

```python
# Приклад розрахунку часткової кореляції
from pingouin import partial_corr

# Створення третьої змінної, яка впливає на x та y
z = np.random.normal(0, 1, 100)
x_with_z = x + 0.5 * z
y_with_z = y + 0.3 * z

# Створення DataFrame для аналізу
df = pd.DataFrame({'x': x_with_z, 'y': y_with_z, 'z': z})

# Розрахунок часткової кореляції
partial = partial_corr(data=df, x='x', y='y', covar='z')
print(f"Часткова кореляція між x та y з контролем z: {partial['r'].values[0]:.4f}")
```

## Кореляційна матриця

[Буде наповнено: Поняття кореляційної матриці для аналізу взаємозв'язків між багатьма змінними одночасно.]

### Побудова та аналіз

[Буде наповнено: Методика створення кореляційної матриці в Python та принципи її аналізу.]

```python
# Приклад побудови кореляційної матриці
# Створення набору даних з кількома змінними
df = pd.DataFrame({
    'A': np.random.normal(0, 1, 100),
    'B': np.random.normal(0, 1, 100),
    'C': np.random.normal(0, 1, 100),
    'D': np.random.normal(0, 1, 100)
})

# Додавання залежностей між змінними
df['B'] = df['A'] * 0.6 + df['B'] * 0.4
df['D'] = df['C'] * 0.7 + df['D'] * 0.3

# Побудова кореляційної матриці
corr_matrix = df.corr()
print("Кореляційна матриця:")
print(corr_matrix)
```

## Теплова карта кореляцій

[Буде наповнено: Візуалізація кореляційної матриці за допомогою теплової карти (heatmap) для інтуїтивного розуміння взаємозв'язків.]

### Створення за допомогою Seaborn

[Буде наповнено: Методика побудови теплової карти кореляцій з використанням бібліотеки Seaborn.]

```python
# Приклад побудови теплової карти кореляцій
import matplotlib.pyplot as plt
import seaborn as sns

plt.figure(figsize=(10, 8))
sns.heatmap(corr_matrix, annot=True, cmap='coolwarm', vmin=-1, vmax=1, center=0)
plt.title('Теплова карта кореляцій')
plt.tight_layout()
plt.show()
```

### Інтерпретація теплової карти

[Буде наповнено: Принципи аналізу теплової карти кореляцій. Виявлення кластерів змінних та потенційних мультиколінеарностей.]

## Інтерпретація коефіцієнтів кореляції

[Буде наповнено: Детальні рекомендації щодо інтерпретації різних значень коефіцієнтів кореляції.]

### Шкала сили зв'язку

[Буде наповнено: Стандартні градації сили кореляційного зв'язку (слабка, помірна, сильна) та їх числові межі.]

### Візуалізація різних рівнів кореляції

[Буде наповнено: Приклади діаграм розсіювання для різних рівнів кореляції для розвитку інтуїтивного розуміння.]

```python
# Приклад візуалізації різних рівнів кореляції
np.random.seed(42)

# Створення даних з різними рівнями кореляції
n = 100
x = np.random.normal(0, 1, n)

# Дані з різними рівнями кореляції
y_strong_pos = x * 0.9 + np.random.normal(0, 0.3, n)  # Сильна позитивна кореляція
y_moderate_pos = x * 0.5 + np.random.normal(0, 0.7, n)  # Помірна позитивна кореляція
y_weak_pos = x * 0.2 + np.random.normal(0, 0.95, n)  # Слабка позитивна кореляція
y_no_corr = np.random.normal(0, 1, n)  # Відсутність кореляції
y_moderate_neg = -x * 0.5 + np.random.normal(0, 0.7, n)  # Помірна негативна кореляція

# Розрахунок кореляції для кожної пари
corr_strong_pos = np.corrcoef(x, y_strong_pos)[0, 1]
corr_moderate_pos = np.corrcoef(x, y_moderate_pos)[0, 1]
corr_weak_pos = np.corrcoef(x, y_weak_pos)[0, 1]
corr_no_corr = np.corrcoef(x, y_no_corr)[0, 1]
corr_moderate_neg = np.corrcoef(x, y_moderate_neg)[0, 1]

# Візуалізація
fig, axs = plt.subplots(1, 5, figsize=(20, 4))
titles = [
    f'Сильна позитивна\nr = {corr_strong_pos:.2f}',
    f'Помірна позитивна\nr = {corr_moderate_pos:.2f}',
    f'Слабка позитивна\nr = {corr_weak_pos:.2f}',
    f'Відсутність кореляції\nr = {corr_no_corr:.2f}',
    f'Помірна негативна\nr = {corr_moderate_neg:.2f}'
]

data_pairs = [
    (x, y_strong_pos),
    (x, y_moderate_pos),
    (x, y_weak_pos),
    (x, y_no_corr),
    (x, y_moderate_neg)
]

for i, (pair, title) in enumerate(zip(data_pairs, titles)):
    axs[i].scatter(pair[0], pair[1], alpha=0.6)
    axs[i].set_title(title)
    axs[i].set_xlabel('X')
    axs[i].set_ylabel('Y')
    # Додавання лінії регресії
    m, b = np.polyfit(pair[0], pair[1], 1)
    axs[i].plot(pair[0], m * pair[0] + b, color='red', linestyle='--')

plt.tight_layout()
plt.show()
```

## Кореляція vs причинно-наслідковий зв'язок

[Буде наповнено: Роз'яснення різниці між кореляцією та причинно-наслідковим зв'язком. Принцип "кореляція не означає причинність".]

### Типові помилки інтерпретації

[Буде наповнено: Найпоширеніші помилки при тлумаченні кореляційних зв'язків як причинно-наслідкових.]

### Приклади оманливих кореляцій

[Буде наповнено: Класичні приклади оманливих кореляцій та їх пояснення.]

## Статистична значущість кореляції

[Буде наповнено: Методи перевірки статистичної значущості кореляційних коефіцієнтів. Розрахунок p-значень та довірчих інтервалів.]

### Перевірка гіпотез для коефіцієнтів кореляції

[Буде наповнено: Формулювання нульової та альтернативної гіпотез для кореляційного аналізу. Процедура статистичної перевірки.]

```python
# Приклад перевірки статистичної значущості кореляції
from scipy import stats
import numpy as np

# Створення пари змінних з низькою кореляцією
np.random.seed(42)
x = np.random.normal(0, 1, 30)
y = x * 0.3 + np.random.normal(0, 0.95, 30)

# Розрахунок кореляції та її значущості
r, p_value = stats.pearsonr(x, y)

print(f"Коефіцієнт кореляції Пірсона: {r:.4f}")
print(f"P-значення: {p_value:.6f}")

# Інтерпретація
alpha = 0.05
if p_value < alpha:
    print(f"Кореляція є статистично значущою (p < {alpha})")
else:
    print(f"Кореляція не є статистично значущою (p >= {alpha})")

# Розрахунок довірчого інтервалу для коефіцієнта кореляції
n = len(x)
r_z = np.arctanh(r)  # Перетворення Фішера
se = 1 / np.sqrt(n - 3)
z = stats.norm.ppf(1 - alpha/2)
lo_z, hi_z = r_z - z * se, r_z + z * se
lo, hi = np.tanh([lo_z, hi_z])

print(f"95% довірчий інтервал для коефіцієнта кореляції: [{lo:.4f}, {hi:.4f}]")
```

## Практичні приклади аналізу

[Буде наповнено: Детальні приклади застосування кореляційного аналізу на реальних наборах даних.]

### Аналіз фінансових даних

[Буде наповнено: Приклад кореляційного аналізу фінансових інструментів. Виявлення взаємозв'язків між акціями, індексами та економічними показниками.]

### Аналіз медичних даних

[Буде наповнено: Приклад застосування кореляційного аналізу для дослідження взаємозв'язків між медичними показниками.]

### Аналіз маркетингових даних

[Буде наповнено: Приклад використання кореляції для аналізу ефективності маркетингових кампаній та поведінки споживачів.]

## Типові помилки при інтерпретації кореляції

[Буде наповнено: Детальний розбір типових помилок при проведенні та інтерпретації кореляційного аналізу.]

### Ігнорування нелінійних зв'язків

[Буде наповнено: Проблема виявлення нелінійних зв'язків при використанні лінійних коефіцієнтів кореляції.]

```python
# Приклад нелінійного зв'язку, який не виявляється лінійною кореляцією
np.random.seed(42)
x = np.linspace(-3, 3, 100)
y = x**2 + np.random.normal(0, 0.5, 100)  # Квадратична залежність з шумом

# Розрахунок коефіцієнта кореляції Пірсона
r, p_value = stats.pearsonr(x, y)
print(f"Коефіцієнт кореляції Пірсона для квадратичної залежності: {r:.4f}")

# Візуалізація
plt.figure(figsize=(8, 6))
plt.scatter(x, y, alpha=0.6)
plt.title(f'Квадратична залежність з низькою лінійною кореляцією (r = {r:.2f})')
plt.xlabel('X')
plt.ylabel('Y')
plt.grid(True, alpha=0.3)
plt.show()
```

### Вплив викидів на кореляцію

[Буде наповнено: Аналіз впливу екстремальних значень на результати кореляційного аналізу.]

### Екологічна помилка

[Буде наповнено: Опис екологічної помилки (ecological fallacy) при аналізі агрегованих даних та її запобігання.]

---

## Висновки

[Буде наповнено: Узагальнення ключових концепцій розділу. Рекомендації щодо ефективного застосування кореляційного аналізу в різних сферах.]

## Додаткові ресурси

[Буде наповнено: Список рекомендованої літератури та онлайн-ресурсів для поглибленого вивчення кореляційного аналізу.]

---

[⬅️ Попередня тема](./21_аномалії_та_викиди.md) | [➡️ Наступна тема](./23_зниження_розмірності.md)
