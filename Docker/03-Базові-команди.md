# 03. Базові команди Docker

Docker пропонує широкий набір команд для управління контейнерами та образами. В цьому розділі ми розглянемо основні команди, які використовуються найчастіше.

## Робота з контейнерами

### docker pull - завантаження образів

Команда `docker pull` використовується для завантаження образів з Docker Hub або іншого реєстру.

Синтаксис:

```bash
docker pull [OPTIONS] NAME[:TAG|@DIGEST]
```

Приклади:

```bash
# Завантаження останньої версії образу Ubuntu
docker pull ubuntu

# Завантаження конкретної версії образу
docker pull ubuntu:20.04

# Завантаження з іншого реєстру
docker pull registry.example.com/myimage:latest
```

> **Порада:** Завжди вказуйте конкретну версію (тег) образу для гарантії сумісності вашого додатку.

### docker run - запуск контейнерів

Команда `docker run` створює та запускає новий контейнер на основі образу.

Синтаксис:

```bash
docker run [OPTIONS] IMAGE [COMMAND] [ARG...]
```

Основні опції:

-   `-d, --detach` - запуск у фоновому режимі
-   `-p, --publish` - публікація портів
-   `-v, --volume` - монтування томів
-   `-e, --env` - встановлення змінних середовища
-   `--name` - задання імені контейнера
-   `--rm` - автоматичне видалення контейнера після зупинки

Приклади:

```bash
# Запуск контейнера в інтерактивному режимі
docker run -it ubuntu bash

# Запуск веб-сервера з перенаправленням портів
docker run -d -p 8080:80 nginx

# Запуск з іменем, видаленням після зупинки і монтуванням тому
docker run --name my_app --rm -v $(pwd):/app -p 3000:3000 node:14
```

> **Важливо!** Команда `docker run` завжди створює новий контейнер. Якщо вам потрібно запустити існуючий контейнер, використовуйте `docker start`.

### docker ps - перегляд запущених контейнерів

Команда `docker ps` показує список запущених контейнерів.

Синтаксис:

```bash
docker ps [OPTIONS]
```

Основні опції:

-   `-a, --all` - показати всі контейнери (включно з зупиненими)
-   `-q, --quiet` - показати тільки ID контейнерів
-   `-s, --size` - показати розмір файлової системи

Приклади:

```bash
# Показати запущені контейнери
docker ps

# Показати всі контейнери
docker ps -a

# Показати тільки ID всіх контейнерів
docker ps -aq
```

### docker stop - зупинка контейнерів

Команда `docker stop` зупиняє запущені контейнери.

Синтаксис:

```bash
docker stop [OPTIONS] CONTAINER [CONTAINER...]
```

Приклади:

```bash
# Зупинити контейнер за ID
docker stop 1a2b3c4d5e6f

# Зупинити контейнер за іменем
docker stop my_container

# Зупинити кілька контейнерів
docker stop container1 container2

# Зупинити всі запущені контейнери
docker stop $(docker ps -q)
```

> **Порада:** Використовуйте `docker kill`, якщо контейнер не реагує на `docker stop`. `docker stop` надсилає сигнал SIGTERM, даючи програмі шанс коректно завершитися, а `docker kill` використовує SIGKILL для негайного завершення.

### docker rm - видалення контейнерів

Команда `docker rm` видаляє зупинені контейнери.

Синтаксис:

```bash
docker rm [OPTIONS] CONTAINER [CONTAINER...]
```

Основні опції:

-   `-f, --force` - примусове видалення запущеного контейнера
-   `-v, --volumes` - видалення пов'язаних анонімних томів

Приклади:

```bash
# Видалення контейнера
docker rm my_container

# Примусове видалення запущеного контейнера
docker rm -f my_container

# Видалення кількох контейнерів
docker rm container1 container2

# Видалення всіх зупинених контейнерів
docker rm $(docker ps -aq -f status=exited)
```

## Робота з образами

### docker images - перегляд образів

Команда `docker images` показує список локально доступних образів.

Синтаксис:

```bash
docker images [OPTIONS] [REPOSITORY[:TAG]]
```

Основні опції:

-   `-a, --all` - показати всі образи
-   `-q, --quiet` - показати тільки ID образів
-   `--digests` - показати дайджести образів

Приклади:

```bash
# Показати всі образи
docker images

# Показати тільки образи nginx
docker images nginx

# Показати тільки ID всіх образів
docker images -q
```

### docker rmi - видалення образів

Команда `docker rmi` видаляє образи з локального сховища.

Синтаксис:

```bash
docker rmi [OPTIONS] IMAGE [IMAGE...]
```

Основні опції:

-   `-f, --force` - примусове видалення

Приклади:

```bash
# Видалення образу за тегом
docker rmi ubuntu:20.04

# Видалення образу за ID
docker rmi 1a2b3c4d5e6f

# Видалення кількох образів
docker rmi image1 image2

# Видалення всіх невикористовуваних образів
docker rmi $(docker images -q -f dangling=true)
```

> **Важливо!** Неможливо видалити образ, який використовується запущеним контейнером, без опції `-f`.

## Інші корисні команди

### docker exec - виконання команд у запущеному контейнері

```bash
# Запуск інтерактивного шелу в контейнері
docker exec -it my_container bash

# Виконання окремої команди
docker exec my_container ls -la
```

### docker logs - перегляд логів контейнера

```bash
# Перегляд всіх логів
docker logs my_container

# Відстеження логів у реальному часі
docker logs -f my_container

# Перегляд останніх N рядків
docker logs --tail 100 my_container
```

### docker inspect - отримання детальної інформації

```bash
# Інформація про контейнер
docker inspect my_container

# Інформація про образ
docker inspect ubuntu:20.04

# Отримання конкретного поля
docker inspect --format='{{.NetworkSettings.IPAddress}}' my_container
```

### docker cp - копіювання файлів між контейнером і хостом

```bash
# Копіювання з контейнера на хост
docker cp my_container:/app/file.txt ./local-file.txt

# Копіювання з хоста в контейнер
docker cp ./local-file.txt my_container:/app/file.txt
```

## Приклад комплексного використання

Розглянемо типовий сценарій роботи з Docker для запуску веб-додатку:

```bash
# Крок 1: Завантаження образу
docker pull nginx:latest

# Крок 2: Запуск контейнера з перенаправленням портів і монтуванням вмісту сайту
docker run -d --name my_website -p 8080:80 -v $(pwd)/website:/usr/share/nginx/html nginx:latest

# Крок 3: Перевірка запущених контейнерів
docker ps

# Крок 4: Перегляд логів
docker logs my_website

# Крок 5: Підключення до контейнера для налагодження
docker exec -it my_website bash

# Крок 6: Зупинка контейнера після завершення роботи
docker stop my_website

# Крок 7: Видалення контейнера, якщо він більше не потрібен
docker rm my_website
```

## Типові проблеми та їх вирішення

1. **Проблема**: Не вдається запустити контейнер через зайнятий порт.
   **Рішення**: Змініть порт на хості: `-p 8081:80`

2. **Проблема**: Контейнер запускається і одразу зупиняється.
   **Рішення**: Додайте прапор `-it` для інтерактивного режиму або перевірте, чи головний процес не завершується.

3. **Проблема**: Зміни у примонтованих файлах не відображаються у контейнері.
   **Рішення**: Перевірте правильність шляхів монтування та права доступу.

## Найкращі практики

1. **Завжди давайте осмислені імена контейнерам** за допомогою параметра `--name`, щоб легко ідентифікувати їх призначення.
2. **Використовуйте прапорець `--rm`** для тимчасових контейнерів, щоб уникнути накопичення зупинених контейнерів.
3. **Зберігайте дані поза контейнерами** за допомогою томів (`-v`) для забезпечення персистентності.
4. **Використовуйте конкретні теги образів** замість `latest` для забезпечення передбачуваності.
5. **Періодично запускайте `docker system prune`** для очищення невикористовуваних ресурсів (зупинені контейнери, невикористовувані образи та мережі).
6. **Використовуйте скрипти або Docker Compose** для складних команд запуску, щоб спростити розгортання.
